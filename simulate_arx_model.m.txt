function y_sim = simulate_arx_model(theta, u, y, na, nb, nk)
    N = length(u);  % Number of samples
    y_sim = zeros(N, 1);  % Initialize the simulated output

    % Extract the AR (past outputs) and X (past inputs) coefficients from theta
    theta_a = theta(1:na);        % Coefficients for past outputs (AR part)
    theta_b = theta(na+1:na+nb);  % Coefficients for past inputs (X part)

    % Recursive calculation of the output
    for t = max(na, nk + nb):N
        % AR part: Contribution from past outputs
        y_part = 0;
        for i = 1:na
            if t-i > 0
                y_part = y_part - theta_a(i) * y_sim(t-i);
            end
        end

        % X part: Contribution from past inputs
        u_part = 0;
        for j = 1:nb
            if t-nk-j+1 > 0
                u_part = u_part + theta_b(j) * u(t-nk-j+1);
            end
        end

        % Compute the simulated output for the current time step
        y_sim(t) = y_part + u_part;
    end
end
